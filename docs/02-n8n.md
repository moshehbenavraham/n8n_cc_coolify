# n8n Workflow Automation

Server: See .env for server details | OS: Ubuntu 24.04 LTS

---

## Overview

- **Image**: `ghcr.io/moshehbenavraham/n8n:latest`
- **Network ID**: `$N8N_NETWORK_ID` (see .env)
- **Mode**: Queue mode with workers

## Access

```
URL: https://n8n.aiwithapex.com
Port: 5678
```

## Container Architecture

```
n8n-$N8N_NETWORK_ID-*          - Main n8n instance
n8n-worker-1/2/3-$N8N_NETWORK_ID-*  - Worker instances (3x)
runner-worker-1/2/3-$N8N_NETWORK_ID-* - Runner instances (3x)
postgres-$N8N_NETWORK_ID-*     - n8n PostgreSQL database
redis-$N8N_NETWORK_ID-*        - Queue management
```

## n8n Database Credentials

```
Host: postgres (internal)
Port: $N8N_DB_PORT
Database: $N8N_DB_NAME
Username: $N8N_DB_USERNAME
Password: $N8N_DB_PASSWORD
```

> Credentials stored in `.env` file

## Critical Configuration

```
N8N_ENCRYPTION_KEY=$N8N_ENCRYPTION_KEY
N8N_RUNNERS_AUTH_TOKEN=$N8N_RUNNERS_AUTH_TOKEN
```

> Critical secrets stored in `.env` file

## Queue Configuration (Redis)

```
QUEUE_BULL_REDIS_HOST=redis
QUEUE_BULL_REDIS_PORT=6379
QUEUE_BULL_REDIS_TIMEOUT_THRESHOLD=60000
QUEUE_WORKER_LOCK_DURATION=60000
```

## Management Commands

```bash
# Source environment variables first
source .env

# View n8n main logs
sudo docker logs $(sudo docker ps -qf name=n8n-$N8N_NETWORK_ID | head -1) -f

# View worker logs
sudo docker logs $(sudo docker ps -qf name=n8n-worker-1-$N8N_NETWORK_ID) -f

# Restart n8n (main only)
sudo docker restart $(sudo docker ps -qf name=n8n-$N8N_NETWORK_ID | head -1)

# Restart all n8n containers
sudo docker restart $(sudo docker ps -qf name=$N8N_NETWORK_ID)

# Access n8n database
sudo docker exec -it $(sudo docker ps -qf name=postgres-$N8N_NETWORK_ID) psql -U $N8N_DB_USERNAME -d n8n

# List n8n database tables
sudo docker exec $(sudo docker ps -qf name=postgres-$N8N_NETWORK_ID) psql -U $N8N_DB_USERNAME -d n8n -c "\dt"

# Check n8n execution count
sudo docker exec $(sudo docker ps -qf name=postgres-$N8N_NETWORK_ID) psql -U $N8N_DB_USERNAME -d n8n -c "SELECT COUNT(*) FROM execution_entity;"
```

## n8n Database Tables (Key Tables)

```
workflow_entity          - Workflow definitions
execution_entity         - Execution records
execution_data           - Execution payloads
credentials_entity       - Encrypted credentials
user                     - User accounts
webhook_entity           - Webhook endpoints
variables                - Environment variables
settings                 - n8n settings
```

## Data Volumes

```
${N8N_NETWORK_ID}_n8n-data      - n8n user data (/home/node/.n8n)
${N8N_NETWORK_ID}_postgres-data - PostgreSQL data
```

---

*Documentation generated: 2026-01-18*
